<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport"
    content="width=device-width,initial-scale=1,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0" />
  <meta name="author" content="火星科技 http://mars3d.cn ">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no">
  <meta name="x5-fullscreen" content="true">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />

  <link rel="shortcut icon" type="image/x-icon" href="http://mars3d.cn/favicon.ico">
  <title>双屏对比 |Mars3D|三维地图| 火星科技|合肥火星科技|合肥火星科技有限公司</title>


  <!--第三方lib-->
  <script type="text/javascript" src="../lib/include-lib.js" libpath="../lib/"
    include="jquery,font-awesome,bootstrap,layer,haoutil,turf,mars3d"></script>

  <link href="css/style.css" rel="stylesheet" />
  <style>
    #centerDiv {
      position: absolute;
      width: 50%;
      height: 100%;
    }

    #centerDivEx {
      position: absolute;
      right: 0px;
      top: 0px;
      border: 1px solid #ccc;
      top: 0px;
      bottom: 0px;
      width: 50%;
    }
  </style>
</head>

<body class="dark">
  <!--加载前进行操作提示，优化用户体验-->
  <div id="mask" class="signmask" onclick="removeMask()"></div>

  <div id="centerDiv">
    <div id="mars3dContainer" class="mars3d-container"></div>
  </div>
  <div id="centerDivEx">
    <div id="cesiumContainerEx" class="mars3d-container"></div>
  </div>


  <script src="./js/common.js"></script>
  <script type="text/javascript">
    'use script' //开发环境建议开启严格模式

    var map
    var mapEx

    function initMap(options) {
      //合并属性参数，可覆盖config.json中的对应配置
      var mapOptions = mars3d.util.merge(options, {
        scene: {
          center: { y: 30.754115, x: 116.341283, z: 14041.23, heading: 5.2, pitch: -49.5, roll: 0 }
        },
        control: {
          geocoder: false
        }
      })

      //创建三维地球场景
      map = new mars3d.Map('mars3dContainer', mapOptions)

      var mapOptions2 = map.getOptions()

      //用于双屏同图层，不同配置展示
      for (var i = 0, len = mapOptions2.layers.length; i < len; i++) {
        var item = mapOptions2.layers[i]
        if (item.compare) {
          //存在compare属性时
          for (var key in item.compare) {
            item[key] = item.compare[key]
          }
        }
      }

      //绑定的控件
      mapOptions2.control = {
        baseLayerPicker: true, //basemaps底图切换按钮
        contextmenu: true //右键菜单
      }

      mapEx = new mars3d.Map('cesiumContainerEx', mapOptions2)
      mapEx.basemap = '天地图电子'

      //场景模式(2D/3D/哥伦布)变换完成
      map.on(mars3d.EventType.morphComplete, function(event) {
        if (map.scene.mode === Cesium.SceneMode.SCENE2D) {
          mapEx.scene.screenSpaceCameraController.enableTilt = false
        } else {
          mapEx.scene.screenSpaceCameraController.enableTilt = true
        }
      })

      map.on(mars3d.EventType.cameraChanged, _map_extentChangeHandler)
      map.camera.percentageChanged = 0.01

      mapEx.on(mars3d.EventType.cameraChanged, _mapEx_extentChangeHandler)
      mapEx.camera.percentageChanged = 0.01

      _map_extentChangeHandler()
    }

    function _map_extentChangeHandler(e) {
      mapEx.off(mars3d.EventType.cameraChanged, _mapEx_extentChangeHandler)

      updateView(map, mapEx)
      mapEx.on(mars3d.EventType.cameraChanged, _mapEx_extentChangeHandler)
    }

    function _mapEx_extentChangeHandler(e) {
      map.off(mars3d.EventType.cameraChanged, _map_extentChangeHandler)

      updateView(mapEx, map)
      map.on(mars3d.EventType.cameraChanged, _map_extentChangeHandler)
    }

    //“变化屏”mapChange变化，将“被更新屏”mapUpdate同步更新
    function updateView(mapChange, mapUpdate) {
      var view = mapChange.getCameraView()
      mapUpdate.centerAt(view, { duration: 0 })
    }
  </script>
</body>

</html>
